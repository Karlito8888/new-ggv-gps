<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Coordinate Validation</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-case { 
            background: #f5f5f5; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .success { background: #e0ffe0; }
        .error { background: #ffe0e0; }
        .code { 
            background: #333; 
            color: #fff; 
            padding: 10px; 
            border-radius: 3px; 
            font-family: monospace; 
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de Validation des Coordonn√©es</h1>
    
    <h2>Sc√©narios de Test</h2>
    
    <div class="test-case">
        <h3>Cas 1: Coordonn√©es valides</h3>
        <div class="code">
destination = {
  coordinates: [120.95134859887523, 14.347872973134175],
  blockNumber: 7,
  lotNumber: 4
}
        </div>
        <div id="result1"></div>
    </div>

    <div class="test-case">
        <h3>Cas 2: Coordonn√©es null (ancien bug)</h3>
        <div class="code">
destination = {
  coordinates: null,
  blockNumber: 7,
  lotNumber: 4
}
        </div>
        <div id="result2"></div>
    </div>

    <div class="test-case">
        <h3>Cas 3: Coordonn√©es undefined</h3>
        <div class="code">
destination = {
  coordinates: undefined,
  blockNumber: 7,
  lotNumber: 4
}
        </div>
        <div id="result3"></div>
    </div>

    <div class="test-case">
        <h3>Cas 4: Array invalide</h3>
        <div class="code">
destination = {
  coordinates: [120.9513], // Un seul √©l√©ment
  blockNumber: 7,
  lotNumber: 4
}
        </div>
        <div id="result4"></div>
    </div>

    <div class="test-case">
        <h3>Cas 5: Pas de propri√©t√© coordinates</h3>
        <div class="code">
destination = {
  blockNumber: 7,
  lotNumber: 4
  // coordinates manquante
}
        </div>
        <div id="result5"></div>
    </div>

    <script>
        // Fonction de validation selon la documentation MapLibre
        function validateCoordinates(destination) {
            if (!destination) return false;
            
            // Validation selon la documentation officielle MapLibre
            return destination.coordinates && 
                   Array.isArray(destination.coordinates) && 
                   destination.coordinates.length === 2 &&
                   typeof destination.coordinates[0] === 'number' &&
                   typeof destination.coordinates[1] === 'number' &&
                   !isNaN(destination.coordinates[0]) &&
                   !isNaN(destination.coordinates[1]);
        }

        // Tests
        const testCases = [
            {
                name: "Coordonn√©es valides",
                destination: {
                    coordinates: [120.95134859887523, 14.347872973134175],
                    blockNumber: 7,
                    lotNumber: 4
                },
                expected: true
            },
            {
                name: "Coordonn√©es null (ancien bug)",
                destination: {
                    coordinates: null,
                    blockNumber: 7,
                    lotNumber: 4
                },
                expected: false
            },
            {
                name: "Coordonn√©es undefined",
                destination: {
                    coordinates: undefined,
                    blockNumber: 7,
                    lotNumber: 4
                },
                expected: false
            },
            {
                name: "Array invalide",
                destination: {
                    coordinates: [120.9513], // Un seul √©l√©ment
                    blockNumber: 7,
                    lotNumber: 4
                },
                expected: false
            },
            {
                name: "Pas de propri√©t√© coordinates",
                destination: {
                    blockNumber: 7,
                    lotNumber: 4
                },
                expected: false
            }
        ];

        // Ex√©cuter les tests
        testCases.forEach((testCase, index) => {
            const result = validateCoordinates(testCase.destination);
            const isSuccess = result === testCase.expected;
            const resultDiv = document.getElementById(`result${index + 1}`);
            
            resultDiv.innerHTML = `
                <div class="${isSuccess ? 'success' : 'error'}">
                    <strong>R√©sultat:</strong> ${result ? 'VALIDE' : 'INVALIDE'}<br>
                    <strong>Attendu:</strong> ${testCase.expected ? 'VALIDE' : 'INVALIDE'}<br>
                    <strong>Statut:</strong> ${isSuccess ? '‚úÖ SUCC√àS' : '‚ùå √âCHEC'}
                </div>
            `;
        });

        // R√©sum√©
        const totalTests = testCases.length;
        const passedTests = testCases.filter((test, index) => {
            const result = validateCoordinates(test.destination);
            return result === test.expected;
        }).length;

        document.body.innerHTML += `
            <div class="test-case ${passedTests === totalTests ? 'success' : 'error'}">
                <h2>üìä R√©sum√© des Tests</h2>
                <p><strong>Total:</strong> ${totalTests} tests</p>
                <p><strong>R√©ussis:</strong> ${passedTests} tests</p>
                <p><strong>√âchecs:</strong> ${totalTests - passedTests} tests</p>
                <p><strong>Taux de r√©ussite:</strong> ${Math.round((passedTests / totalTests) * 100)}%</p>
            </div>
        `;
    </script>
</body>
</html>